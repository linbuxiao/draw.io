<mxfile host="app.diagrams.net" modified="2021-09-23T15:34:30.968Z" agent="5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/93.0.4577.82 Safari/537.36" etag="HjB29bKUcHXs4Zr-WoDV" version="14.9.0" type="github" pages="4">
  <diagram id="lv1_gFHEJwcCrWSppvjK" name="render">
    <mxGraphModel dx="868" dy="460" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="RoSgK5wcDo2d3MFYOaGa-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;sketch=1;" parent="1" source="RoSgK5wcDo2d3MFYOaGa-1" target="RoSgK5wcDo2d3MFYOaGa-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="RoSgK5wcDo2d3MFYOaGa-1" value="render" style="rounded=0;whiteSpace=wrap;html=1;sketch=1;" parent="1" vertex="1">
          <mxGeometry x="80" y="60" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="pkWJzS0Snd8bJaj5jlss-18" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="RoSgK5wcDo2d3MFYOaGa-2" target="pkWJzS0Snd8bJaj5jlss-17" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="RoSgK5wcDo2d3MFYOaGa-2" value="创建根树" style="rounded=0;whiteSpace=wrap;html=1;sketch=1;" parent="1" vertex="1">
          <mxGeometry x="280" y="60" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="pkWJzS0Snd8bJaj5jlss-17" value="reconcile初始化instance" style="whiteSpace=wrap;html=1;rounded=0;sketch=1;" parent="1" vertex="1">
          <mxGeometry x="480" y="60" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="pkWJzS0Snd8bJaj5jlss-35" value="class Component" style="whiteSpace=wrap;html=1;align=center;" parent="1" vertex="1">
          <mxGeometry x="40" y="740" width="120" height="60" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="ArnOyYI_-Ao7WKlO_2XD" name="reconcile">
    <mxGraphModel dx="981" dy="526" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="yb2F58JOdo48cuYBgVjA-0" />
        <mxCell id="yb2F58JOdo48cuYBgVjA-1" parent="yb2F58JOdo48cuYBgVjA-0" />
        <mxCell id="-XljYPsHMA2_j690H8TF-0" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="yb2F58JOdo48cuYBgVjA-1" source="-XljYPsHMA2_j690H8TF-5" target="-XljYPsHMA2_j690H8TF-7">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-XljYPsHMA2_j690H8TF-1" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.434;entryY=0.009;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="yb2F58JOdo48cuYBgVjA-1" source="-XljYPsHMA2_j690H8TF-5" target="-XljYPsHMA2_j690H8TF-13">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="409" y="340" />
              <mxPoint x="412" y="340" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-XljYPsHMA2_j690H8TF-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="yb2F58JOdo48cuYBgVjA-1" source="-XljYPsHMA2_j690H8TF-5">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="544" y="310" as="targetPoint" />
            <Array as="points">
              <mxPoint x="544" y="230" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-XljYPsHMA2_j690H8TF-4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="yb2F58JOdo48cuYBgVjA-1" source="-XljYPsHMA2_j690H8TF-5" target="-XljYPsHMA2_j690H8TF-21">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="maoIxlZPQ1FecyRUHIJR-3" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;align=left;" edge="1" parent="yb2F58JOdo48cuYBgVjA-1" source="-XljYPsHMA2_j690H8TF-5" target="-XljYPsHMA2_j690H8TF-10">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-XljYPsHMA2_j690H8TF-5" value="&lt;font&gt;reconcile&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;sketch=1;fontFamily=Helvetica;" vertex="1" parent="yb2F58JOdo48cuYBgVjA-1">
          <mxGeometry x="230" y="170" width="354" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-XljYPsHMA2_j690H8TF-6" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="yb2F58JOdo48cuYBgVjA-1" source="-XljYPsHMA2_j690H8TF-7" target="-XljYPsHMA2_j690H8TF-8">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-XljYPsHMA2_j690H8TF-7" value="instance === null&lt;br&gt;初始化原型树" style="whiteSpace=wrap;html=1;rounded=0;sketch=1;" vertex="1" parent="yb2F58JOdo48cuYBgVjA-1">
          <mxGeometry x="84" y="310" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-XljYPsHMA2_j690H8TF-8" value="instantiate" style="whiteSpace=wrap;html=1;rounded=0;sketch=1;" vertex="1" parent="yb2F58JOdo48cuYBgVjA-1">
          <mxGeometry x="84" y="450" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-XljYPsHMA2_j690H8TF-9" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="yb2F58JOdo48cuYBgVjA-1" source="-XljYPsHMA2_j690H8TF-10" target="-XljYPsHMA2_j690H8TF-11">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-XljYPsHMA2_j690H8TF-10" value="element === null&lt;br&gt;该元素之前存在，后来被删除了。" style="whiteSpace=wrap;html=1;rounded=0;sketch=1;" vertex="1" parent="yb2F58JOdo48cuYBgVjA-1">
          <mxGeometry x="210" y="310" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-XljYPsHMA2_j690H8TF-11" value="parentDom删除intance.dom&lt;br&gt;并返回instance为null" style="whiteSpace=wrap;html=1;rounded=0;sketch=1;" vertex="1" parent="yb2F58JOdo48cuYBgVjA-1">
          <mxGeometry x="210" y="450" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-XljYPsHMA2_j690H8TF-12" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="yb2F58JOdo48cuYBgVjA-1" source="-XljYPsHMA2_j690H8TF-13" target="-XljYPsHMA2_j690H8TF-15">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-XljYPsHMA2_j690H8TF-13" value="instance.type !== element.type&lt;br&gt;新生成的元素和之前的元素不同" style="whiteSpace=wrap;html=1;rounded=0;sketch=1;" vertex="1" parent="yb2F58JOdo48cuYBgVjA-1">
          <mxGeometry x="353.5" y="310" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-XljYPsHMA2_j690H8TF-14" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="yb2F58JOdo48cuYBgVjA-1" source="-XljYPsHMA2_j690H8TF-15" target="-XljYPsHMA2_j690H8TF-16">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-XljYPsHMA2_j690H8TF-15" value="updateDomProperties&lt;br&gt;重新赋予dom属性" style="whiteSpace=wrap;html=1;rounded=0;sketch=1;" vertex="1" parent="yb2F58JOdo48cuYBgVjA-1">
          <mxGeometry x="354" y="450" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-XljYPsHMA2_j690H8TF-16" value="reconcileChild&lt;br&gt;重新生成子树的原型，返回子树原型的数组。挂在到原型上" style="whiteSpace=wrap;html=1;rounded=0;sketch=1;" vertex="1" parent="yb2F58JOdo48cuYBgVjA-1">
          <mxGeometry x="354" y="590" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-XljYPsHMA2_j690H8TF-17" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="yb2F58JOdo48cuYBgVjA-1" source="-XljYPsHMA2_j690H8TF-18" target="-XljYPsHMA2_j690H8TF-19">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-XljYPsHMA2_j690H8TF-18" value="element.type === &#39;string&#39;&lt;br&gt;此时element不为组件" style="whiteSpace=wrap;html=1;" vertex="1" parent="yb2F58JOdo48cuYBgVjA-1">
          <mxGeometry x="488" y="310" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-XljYPsHMA2_j690H8TF-19" value="instantiate&lt;br&gt;重新生成原型树&lt;br&gt;并替换dom" style="whiteSpace=wrap;html=1;" vertex="1" parent="yb2F58JOdo48cuYBgVjA-1">
          <mxGeometry x="488" y="450" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-XljYPsHMA2_j690H8TF-20" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="yb2F58JOdo48cuYBgVjA-1" source="-XljYPsHMA2_j690H8TF-21" target="-XljYPsHMA2_j690H8TF-22">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-XljYPsHMA2_j690H8TF-21" value="element为组件" style="whiteSpace=wrap;html=1;rounded=0;sketch=1;" vertex="1" parent="yb2F58JOdo48cuYBgVjA-1">
          <mxGeometry x="624" y="310" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-XljYPsHMA2_j690H8TF-22" value="&lt;div&gt;&lt;span&gt;重新给props赋值&lt;/span&gt;&lt;/div&gt;&lt;div&gt;通过render方法获得jsx对象&lt;/div&gt;&lt;div&gt;reconcile传递旧的childInstance和新的childElement，返回新的原型树&lt;/div&gt;&lt;div&gt;挂载回instance&lt;/div&gt;" style="whiteSpace=wrap;html=1;rounded=0;sketch=1;align=center;" vertex="1" parent="yb2F58JOdo48cuYBgVjA-1">
          <mxGeometry x="624" y="450" width="120" height="150" as="geometry" />
        </mxCell>
        <mxCell id="maoIxlZPQ1FecyRUHIJR-0" value="reconcile是render的起点，最终会返回一个原型实例。&lt;br&gt;原型分两种：&lt;br&gt;1. dom元素：{element, dom, childInstance}&lt;br&gt;2. 组件元素：{element, dom, childInstance, publicInstance}&lt;br&gt;&lt;br&gt;在生成原型的过程中，会在 instantiate 与 reconcile内对dom进行操作" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="yb2F58JOdo48cuYBgVjA-1">
          <mxGeometry x="30" width="380" height="90" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="ACPxxyxjKngt-OYr-YqM" name="Component">
    <mxGraphModel dx="981" dy="526" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="eonbvHzt3GFAqSXuPtur-0" />
        <mxCell id="eonbvHzt3GFAqSXuPtur-1" parent="eonbvHzt3GFAqSXuPtur-0" />
        <mxCell id="eonbvHzt3GFAqSXuPtur-4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;align=left;" edge="1" parent="eonbvHzt3GFAqSXuPtur-1" source="eonbvHzt3GFAqSXuPtur-2" target="eonbvHzt3GFAqSXuPtur-3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="eonbvHzt3GFAqSXuPtur-10" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;align=left;" edge="1" parent="eonbvHzt3GFAqSXuPtur-1" source="eonbvHzt3GFAqSXuPtur-2" target="eonbvHzt3GFAqSXuPtur-9">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="eonbvHzt3GFAqSXuPtur-2" value="Component" style="whiteSpace=wrap;html=1;align=center;" vertex="1" parent="eonbvHzt3GFAqSXuPtur-1">
          <mxGeometry x="320" y="120" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="eonbvHzt3GFAqSXuPtur-6" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;align=left;" edge="1" parent="eonbvHzt3GFAqSXuPtur-1" source="eonbvHzt3GFAqSXuPtur-3" target="eonbvHzt3GFAqSXuPtur-5">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="eonbvHzt3GFAqSXuPtur-8" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;align=left;" edge="1" parent="eonbvHzt3GFAqSXuPtur-1" source="eonbvHzt3GFAqSXuPtur-3" target="eonbvHzt3GFAqSXuPtur-7">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="eonbvHzt3GFAqSXuPtur-3" value="constructor(props)" style="whiteSpace=wrap;html=1;" vertex="1" parent="eonbvHzt3GFAqSXuPtur-1">
          <mxGeometry x="160" y="280" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="eonbvHzt3GFAqSXuPtur-5" value="this.props = props" style="whiteSpace=wrap;html=1;" vertex="1" parent="eonbvHzt3GFAqSXuPtur-1">
          <mxGeometry x="50" y="420" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="eonbvHzt3GFAqSXuPtur-7" value="this.state = this.state || {}" style="whiteSpace=wrap;html=1;" vertex="1" parent="eonbvHzt3GFAqSXuPtur-1">
          <mxGeometry x="260" y="420" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="eonbvHzt3GFAqSXuPtur-12" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;align=left;" edge="1" parent="eonbvHzt3GFAqSXuPtur-1" source="eonbvHzt3GFAqSXuPtur-9" target="eonbvHzt3GFAqSXuPtur-11">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="eonbvHzt3GFAqSXuPtur-9" value="setState(partialState)" style="whiteSpace=wrap;html=1;" vertex="1" parent="eonbvHzt3GFAqSXuPtur-1">
          <mxGeometry x="470" y="280" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="eonbvHzt3GFAqSXuPtur-14" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;align=left;" edge="1" parent="eonbvHzt3GFAqSXuPtur-1" source="eonbvHzt3GFAqSXuPtur-11" target="eonbvHzt3GFAqSXuPtur-13">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="eonbvHzt3GFAqSXuPtur-11" value="Object.assign" style="whiteSpace=wrap;html=1;" vertex="1" parent="eonbvHzt3GFAqSXuPtur-1">
          <mxGeometry x="470" y="420" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="eonbvHzt3GFAqSXuPtur-16" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;align=left;" edge="1" parent="eonbvHzt3GFAqSXuPtur-1" source="eonbvHzt3GFAqSXuPtur-13" target="eonbvHzt3GFAqSXuPtur-15">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="eonbvHzt3GFAqSXuPtur-13" value="updateInstance(this.interalInstance)" style="whiteSpace=wrap;html=1;" vertex="1" parent="eonbvHzt3GFAqSXuPtur-1">
          <mxGeometry x="430" y="560" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="eonbvHzt3GFAqSXuPtur-15" value="reconcile&lt;br&gt;传入组件原型，重新渲染了组件" style="whiteSpace=wrap;html=1;" vertex="1" parent="eonbvHzt3GFAqSXuPtur-1">
          <mxGeometry x="470" y="700" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="eonbvHzt3GFAqSXuPtur-17" value="之所以要挂载`internalInstance`，因为在setState的时候需要原型来`reconcile`。&lt;br&gt;整体具有`rootInstance`作为根树引用，所以节点之间的关联得以保持。" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="eonbvHzt3GFAqSXuPtur-1">
          <mxGeometry x="50" y="45" width="440" height="30" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="lhICQb641Dhu0uLrRg4f" name="workLoop">
    <mxGraphModel dx="745" dy="317" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" background="#F4F1DE" math="0" shadow="0">
      <root>
        <mxCell id="g3B3UN_uxZvj73UsXVyf-0" />
        <mxCell id="g3B3UN_uxZvj73UsXVyf-1" parent="g3B3UN_uxZvj73UsXVyf-0" />
        <mxCell id="-wJ37s-rePBMo6hdcact-0" value="重构了instance，将原型转化为fiber原型&lt;br&gt;加入了队列循环结构，便于在浏览器堵塞时停止递归&lt;br&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fontColor=#393C56;" vertex="1" parent="g3B3UN_uxZvj73UsXVyf-1">
          <mxGeometry x="21" y="40" width="290" height="30" as="geometry" />
        </mxCell>
        <mxCell id="-wJ37s-rePBMo6hdcact-1" value="" style="shape=image;imageAspect=0;aspect=fixed;verticalLabelPosition=bottom;verticalAlign=top;image=https://github.com/chinanf-boy/didact-explain/blob/master/imgs/5-pic.png?raw=true;fillColor=#F2CC8F;strokeColor=#E07A5F;fontColor=#393C56;" vertex="1" parent="g3B3UN_uxZvj73UsXVyf-1">
          <mxGeometry x="18" y="80" width="395.89" height="319" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
